<!--
 * @Author: shuang.qing
 * @Date: 2020-07-31 15:50:47
 * @LastEditTime: 2020-08-07 09:10:33
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \ThirdPartServer\views\roleList.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <title>用户管理</title>
</head>

<body>
    <div id="app">
        <el-card :body-style="{ padding: '0px' }">
            <div slot="header">
                <span>
                    <center>
                        <h1>{{title}}</h1>
                    </center>
                </span>
            </div>
            <!-- card body -->
            <el-table :data="userData" v-if="userData" border stripe>
                <el-table-column prop="Name" label="用户名" width="auto">
                </el-table-column>

                <el-table-column prop="UID" label="用户ID" width="auto">
                    <template slot-scope="scope">
                        <el-tag size="medium" v-if="scope.row.UID" type="warning">{{scope.row.UID}}
                        </el-tag>
                    </template>
                </el-table-column>

                <!-- <el-table-column prop="PWD" label="登陆密码" width="auto">
                    <template slot-scope="scope">
                        <el-tag size="medium" v-if="scope.row.PWD" type="danger">{{scope.row.PWD}}
                        </el-tag>
                    </template>
                </el-table-column> -->

                <el-table-column prop="Tel" label="电话号码" width="auto">
                </el-table-column>

                <el-table-column prop="Email" label="邮箱账号" width="auto">
                </el-table-column>

                <el-table-column prop="Role.name" label="角色" width="auto">
                </el-table-column>

                <el-table-column fixed="right" label="操作" width="100">
                    <template slot-scope="scope">
                        <!-- <el-button @click="handleClick(scope.row)" type="text" size="small">编辑</el-button> -->
                        <el-button @click="deleteClick(scope.row)" type="text" size="small">删除</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </el-card>
        <center>
            <el-pagination @current-change="handleCurrentChange" :current-page.sync="currentPage" :page-size="PageSize"
                layout="total, prev, pager, next" :total="totalCount">
            </el-pagination>
        </center>
    </div>
</body>

<script>
    let vm = new Vue({
        el: "#app",
        data() {
            return {
                title: "用户列表",
                BaseUrl: "http://127.0.0.1:3000",
                userData: new Array(),
                // 默认显示第几页
                currentPage: 1,
                // 总条数，根据接口获取数据长度(注意：这里不能为空)
                totalCount: 1,
                // 默认每页显示的条数（可修改）
                PageSize: 10,
            }
        },
        methods: {
            async fetch() {
                let e = await axios.get(`${this.BaseUrl}/user/lists/${this.currentPage}`)
                //console.log(e.data)
                this.userData = e.data.userInfo
                this.totalCount = e.data.userLength
            },
            //handleClick(e) {
            //    window.location.href = `${this.BaseUrl}/pic/useredit/:${e._id}`
            //},
            deleteClick(e) {
                this.$confirm('此操作将永久删除用户信息, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(async () => {
                    let res = await axios.delete(`${this.BaseUrl}/user/delete/${e._id}`)
                    if (res.statusText == 'OK') {
                        this.$message({
                            type: 'success',
                            message: '删除成功!'
                        });
                        this.fetch()
                    }
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: '已取消删除'
                    });
                });
            },
            async handleCurrentChange(val) {
                let e = await axios.get(`${this.BaseUrl}/user/lists/${val}`)
                this.userData = e.data.userInfo
                this.totalCount = e.data.userLength
            }
        },
        beforeMount() { },
        mounted() {
            this.fetch()
        },
    })
</script>


<style>
    * {
        margin: 0;
        padding: 0;
        font-family: -apple-system, "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft Yahei", sans-serif;
    }

    .el-pagination {
        position: relative;
    }
</style>

</html>